function he(t,n){for(var r=0;r<n.length;r++){const e=n[r];if(typeof e!="string"&&!Array.isArray(e)){for(const i in e)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(e,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>e[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}let U=!0,G=!0;function y(t,n,r){const e=t.match(n);return e&&e.length>=r&&parseInt(e[r],10)}function g(t,n,r){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,i=e.addEventListener;e.addEventListener=function(o,a){if(o!==n)return i.apply(this,arguments);const f=c=>{const p=r(c);p&&(a.handleEvent?a.handleEvent(p):a(p))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(a,f),i.apply(this,[o,f])};const s=e.removeEventListener;e.removeEventListener=function(o,a){if(o!==n||!this._eventMap||!this._eventMap[n])return s.apply(this,arguments);if(!this._eventMap[n].has(a))return s.apply(this,arguments);const f=this._eventMap[n].get(a);return this._eventMap[n].delete(a),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,f])},Object.defineProperty(e,"on"+n,{get(){return this["_on"+n]},set(o){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),o&&this.addEventListener(n,this["_on"+n]=o)},enumerable:!0,configurable:!0})}function ge(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(U=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ce(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(G=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function z(){if(typeof window=="object"){if(U)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function M(t,n){!G||console.warn(t+" is deprecated, please use "+n+" instead.")}function ye(t){const n={browser:null,version:null};if(typeof t>"u"||!t.navigator)return n.browser="Not a browser.",n;const{navigator:r}=t;if(r.mozGetUserMedia)n.browser="firefox",n.version=y(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)n.browser="chrome",n.version=y(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))n.browser="safari",n.version=y(r.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return n.browser="Not a supported browser.",n;return n}function O(t){return Object.prototype.toString.call(t)==="[object Object]"}function N(t){return O(t)?Object.keys(t).reduce(function(n,r){const e=O(t[r]),i=e?N(t[r]):t[r],s=e&&!Object.keys(i).length;return i===void 0||s?n:Object.assign(n,{[r]:i})},{}):t}function _(t,n,r){!n||r.has(n.id)||(r.set(n.id,n),Object.keys(n).forEach(e=>{e.endsWith("Id")?_(t,t.get(n[e]),r):e.endsWith("Ids")&&n[e].forEach(i=>{_(t,t.get(i),r)})}))}function L(t,n,r){const e=r?"outbound-rtp":"inbound-rtp",i=new Map;if(n===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===n.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===e&&a.trackId===o.id&&_(t,a,i)})}),i}const I=z;function J(t,n){const r=t&&t.navigator;if(!r.mediaDevices)return;const e=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const f={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const p=typeof a[c]=="object"?a[c]:{ideal:a[c]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const u=function(d,m){return d?d+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(p.ideal!==void 0){f.optional=f.optional||[];let d={};typeof p.ideal=="number"?(d[u("min",c)]=p.ideal,f.optional.push(d),d={},d[u("max",c)]=p.ideal,f.optional.push(d)):(d[u("",c)]=p.ideal,f.optional.push(d))}p.exact!==void 0&&typeof p.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[u("",c)]=p.exact):["min","max"].forEach(d=>{p[d]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[u(d,c)]=p[d])})}),a.advanced&&(f.optional=(f.optional||[]).concat(a.advanced)),f},i=function(a,f){if(n.version>=61)return f(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(p,u,d){u in p&&!(d in p)&&(p[d]=p[u],delete p[u])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=e(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const p=n.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete a.video.facingMode;let u;if(c.exact==="environment"||c.ideal==="environment"?u=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(u=["front"]),u)return r.mediaDevices.enumerateDevices().then(d=>{d=d.filter(l=>l.kind==="videoinput");let m=d.find(l=>u.some(h=>l.label.toLowerCase().includes(h)));return!m&&d.length&&u.includes("back")&&(m=d[d.length-1]),m&&(a.video.deviceId=c.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=e(a.video),I("chrome: "+JSON.stringify(a)),f(a)})}a.video=e(a.video)}return I("chrome: "+JSON.stringify(a)),f(a)},s=function(a){return n.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,f,c){i(a,p=>{r.webkitGetUserMedia(p,f,u=>{c&&c(s(u))})})};if(r.getUserMedia=o.bind(r),r.mediaDevices.getUserMedia){const a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(f){return i(f,c=>a(c).then(p=>{if(c.audio&&!p.getAudioTracks().length||c.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(s(p))))}}}function Se(t,n){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&!!t.navigator.mediaDevices){if(typeof n!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(e){return n(e).then(i=>{const s=e.video&&e.video.width,o=e.video&&e.video.height,a=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},s&&(e.video.mandatory.maxWidth=s),o&&(e.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(e)})}}}function V(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function K(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[e.stream],this.dispatchEvent(o)}),e.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[e.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else g(t,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function $(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const n=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,f){let c=i.apply(this,arguments);return c||(c=n(this,a),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const f=this._senders.indexOf(a);f!==-1&&this._senders.splice(f,1)}}const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(n(this,o))})};const e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(f=>f.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const e=n.apply(this,[]);return e.forEach(i=>i._pc=this),e},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function B(t){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[e,i,s]=arguments;if(arguments.length>0&&typeof e=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof e!="function"))return n.apply(this,[]);const o=function(f){const c={};return f.result().forEach(u=>{const d={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(m=>{d[m]=u.stat(m)}),c[d.id]=d}),c},a=function(f){return new Map(Object.keys(f).map(c=>[c,f[c]]))};if(arguments.length>=2){const f=function(c){i(a(o(c)))};return n.apply(this,[f,e])}return new Promise((f,c)=>{n.apply(this,[function(p){f(a(o(p)))},c])}).then(i,s)}}function H(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s});const e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=e.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>L(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),g(t,"track",e=>(e.receiver._pc=e.srcElement,e)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>L(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const e=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===e&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===e&&(s?o=!0:s=a),a.track===e)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function q(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=n.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(f)===-1&&this._shimmedLocalStreams[a.id].push(f):this._shimmedLocalStreams[a.id]=[a,f],f};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(u=>u.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();r.apply(this,arguments);const f=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(f)};const e=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],e.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const f=this._shimmedLocalStreams[a].indexOf(o);f!==-1&&this._shimmedLocalStreams[a].splice(f,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function X(t,n){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&n.version>=65)return q(t);const r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const p=r.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(u=>this._reverseStreams[u.id])};const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(u=>{if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const u=new t.MediaStream(p.getTracks());this._streams[p.id]=u,this._reverseStreams[u.id]=p,p=u}e.apply(this,[p])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},t.RTCPeerConnection.prototype.addTrack=function(p,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(h=>h===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(h=>h.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const l=this._streams[u.id];if(l)l.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const h=new t.MediaStream([p]);this._streams[u.id]=h,this._reverseStreams[h.id]=u,this.addStream(h)}return this.getSenders().find(h=>h.track===p)};function s(c,p){let u=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{const m=c._reverseStreams[d],l=c._streams[m.id];u=u.replace(new RegExp(l.id,"g"),m.id)}),new RTCSessionDescription({type:p.type,sdp:u})}function o(c,p){let u=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{const m=c._reverseStreams[d],l=c._streams[m.id];u=u.replace(new RegExp(m.id,"g"),l.id)}),new RTCSessionDescription({type:p.type,sdp:u})}["createOffer","createAnswer"].forEach(function(c){const p=t.RTCPeerConnection.prototype[c],u={[c](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[l=>{const h=s(this,l);d[0].apply(null,[h])},l=>{d[1]&&d[1].apply(null,l)},arguments[2]]):p.apply(this,arguments).then(l=>s(this,l))}};t.RTCPeerConnection.prototype[c]=u[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const f=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=f.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(h=>p.track===h)&&(d=this._streams[m])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function b(t,n){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),!!t.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const e=t.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=i[r]})}function Y(t,n){g(t,"negotiationneeded",r=>{const e=r.target;if(!((n.version<72||e.getConfiguration&&e.getConfiguration().sdpSemantics==="plan-b")&&e.signalingState!=="stable"))return r})}const j=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:V,shimOnTrack:K,shimGetSendersWithDtmf:$,shimGetStats:B,shimSenderReceiverGetStats:H,shimAddTrackRemoveTrackWithNative:q,shimAddTrackRemoveTrack:X,shimPeerConnection:b,fixNegotiationNeeded:Y,shimGetUserMedia:J,shimGetDisplayMedia:Se},Symbol.toStringTag,{value:"Module"}));function Q(t,n){const r=t&&t.navigator,e=t&&t.MediaStreamTrack;if(r.getUserMedia=function(i,s,o){M("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(s,o)},!(n.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(o,a,f){a in o&&!(f in o)&&(o[f]=o[a],delete o[a])},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},e&&e.prototype.getSettings){const o=e.prototype.getSettings;e.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(e&&e.prototype.applyConstraints){const o=e.prototype.applyConstraints;e.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function ve(t,n){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||!t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=function(e){if(!(e&&e.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return e.video===!0?e.video={mediaSource:n}:e.video.mediaSource=n,t.navigator.mediaDevices.getUserMedia(e)})}function Z(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function k(t,n){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return e.apply(this,[s||null]).then(f=>{if(n.version<53&&!o)try{f.forEach(c=>{c.type=r[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;f.forEach((p,u)=>{f.set(u,Object.assign({},p,{type:r[p.type]||p.type}))})}return f}).then(o,a)}}function W(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function w(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const e=n.apply(this,[]);return e.forEach(i=>i._pc=this),e}),g(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ee(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){M("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&r.getTracks().includes(e.track)&&this.removeTrack(e)})})}function te(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function re(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const n=t.RTCPeerConnection.prototype.addTransceiver;n&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=n.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=e.sendEncodings,o.sendEncodings=e.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function ne(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const n=t.RTCRtpSender.prototype.getParameters;n&&(t.RTCRtpSender.prototype.getParameters=function(){const e=n.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ie(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const n=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function se(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const n=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}const A=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:Z,shimPeerConnection:k,shimSenderGetStats:W,shimReceiverGetStats:w,shimRemoveStream:ee,shimRTCDataChannel:te,shimAddTransceiver:re,shimGetParameters:ne,shimCreateOffer:ie,shimCreateAnswer:se,shimGetUserMedia:Q,shimGetDisplayMedia:ve},Symbol.toStringTag,{value:"Module"}));function oe(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>n.call(this,i,e)),e.getVideoTracks().forEach(i=>n.call(this,i,e))},t.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),n.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(r);if(e===-1)return;this._localStreams.splice(e,1);const i=r.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function ae(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(s)>=0)return;e._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,e.dispatchEvent(o)})}),n.apply(e,arguments)}}}function ce(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,r=n.createOffer,e=n.createAnswer,i=n.setLocalDescription,s=n.setRemoteDescription,o=n.addIceCandidate;n.createOffer=function(c,p){const u=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[u]);return p?(d.then(c,p),Promise.resolve()):d},n.createAnswer=function(c,p){const u=arguments.length>=2?arguments[2]:arguments[0],d=e.apply(this,[u]);return p?(d.then(c,p),Promise.resolve()):d};let a=function(f,c,p){const u=i.apply(this,[f]);return p?(u.then(c,p),Promise.resolve()):u};n.setLocalDescription=a,a=function(f,c,p){const u=s.apply(this,[f]);return p?(u.then(c,p),Promise.resolve()):u},n.setRemoteDescription=a,a=function(f,c,p){const u=o.apply(this,[f]);return p?(u.then(c,p),Promise.resolve()):u},n.addIceCandidate=a}function pe(t){const n=t&&t.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const r=n.mediaDevices,e=r.getUserMedia.bind(r);n.mediaDevices.getUserMedia=i=>e(fe(i))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,i,s){n.mediaDevices.getUserMedia(e).then(i,s)}.bind(n))}function fe(t){return t&&t.video!==void 0?Object.assign({},t,{video:N(t.video)}):t}function ue(t){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection;t.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const s=[];for(let o=0;o<e.iceServers.length;o++){let a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(M("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(e.iceServers[o])}e.iceServers=s}return new n(e,i)},t.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return n.generateCertificate}})}function de(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function me(t){const n=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):e.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):e.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function le(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const F=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:oe,shimRemoteStreamsAPI:ae,shimCallbacksAPI:ce,shimGetUserMedia:pe,shimConstraints:fe,shimRTCIceServerUrls:ue,shimTrackEventTransceiver:de,shimCreateOfferLegacy:me,shimAudioContext:le},Symbol.toStringTag,{value:"Module"}));var D={exports:{}};(function(t){const n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(r){return r.trim().split(`
`).map(e=>e.trim())},n.splitSections=function(r){return r.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},n.getDescription=function(r){const e=n.splitSections(r);return e&&e[0]},n.getMediaSections=function(r){const e=n.splitSections(r);return e.shift(),e},n.matchPrefix=function(r,e){return n.splitLines(r).filter(i=>i.indexOf(e)===0)},n.parseCandidate=function(r){let e;r.indexOf("a=candidate:")===0?e=r.substring(12).split(" "):e=r.substring(10).split(" ");const i={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let s=8;s<e.length;s+=2)switch(e[s]){case"raddr":i.relatedAddress=e[s+1];break;case"rport":i.relatedPort=parseInt(e[s+1],10);break;case"tcptype":i.tcpType=e[s+1];break;case"ufrag":i.ufrag=e[s+1],i.usernameFragment=e[s+1];break;default:i[e[s]]===void 0&&(i[e[s]]=e[s+1]);break}return i},n.writeCandidate=function(r){const e=[];e.push(r.foundation);const i=r.component;i==="rtp"?e.push(1):i==="rtcp"?e.push(2):e.push(i),e.push(r.protocol.toUpperCase()),e.push(r.priority),e.push(r.address||r.ip),e.push(r.port);const s=r.type;return e.push("typ"),e.push(s),s!=="host"&&r.relatedAddress&&r.relatedPort&&(e.push("raddr"),e.push(r.relatedAddress),e.push("rport"),e.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(e.push("tcptype"),e.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(e.push("ufrag"),e.push(r.usernameFragment||r.ufrag)),"candidate:"+e.join(" ")},n.parseIceOptions=function(r){return r.substr(14).split(" ")},n.parseRtpMap=function(r){let e=r.substr(9).split(" ");const i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.channels=e.length===3?parseInt(e[2],10):1,i.numChannels=i.channels,i},n.writeRtpMap=function(r){let e=r.payloadType;r.preferredPayloadType!==void 0&&(e=r.preferredPayloadType);const i=r.channels||r.numChannels||1;return"a=rtpmap:"+e+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},n.parseExtmap=function(r){const e=r.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},n.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+`\r
`},n.parseFmtp=function(r){const e={};let i;const s=r.substr(r.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),e[i[0].trim()]=i[1];return e},n.writeFmtp=function(r){let e="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const s=[];Object.keys(r.parameters).forEach(o=>{r.parameters[o]!==void 0?s.push(o+"="+r.parameters[o]):s.push(o)}),e+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return e},n.parseRtcpFb=function(r){const e=r.substr(r.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},n.writeRtcpFb=function(r){let e="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(s=>{e+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),e},n.parseSsrcMedia=function(r){const e=r.indexOf(" "),i={ssrc:parseInt(r.substr(7,e-7),10)},s=r.indexOf(":",e);return s>-1?(i.attribute=r.substr(e+1,s-e-1),i.value=r.substr(s+1)):i.attribute=r.substr(e+1),i},n.parseSsrcGroup=function(r){const e=r.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(i=>parseInt(i,10))}},n.getMid=function(r){const e=n.matchPrefix(r,"a=mid:")[0];if(e)return e.substr(6)},n.parseFingerprint=function(r){const e=r.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},n.getDtlsParameters=function(r,e){const i=n.matchPrefix(r+e,"a=fingerprint:");return{role:"auto",fingerprints:i.map(n.parseFingerprint)}},n.writeDtlsParameters=function(r,e){let i="a=setup:"+e+`\r
`;return r.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},n.parseCryptoLine=function(r){const e=r.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},n.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?n.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const e=r.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},n.getCryptoParameters=function(r,e){return n.matchPrefix(r+e,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(r,e){const i=n.matchPrefix(r+e,"a=ice-ufrag:")[0],s=n.matchPrefix(r+e,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substr(12),password:s.substr(10)}:null},n.writeIceParameters=function(r){let e="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(e+=`a=ice-lite\r
`),e},n.parseRtpParameters=function(r){const e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=n.splitLines(r)[0].split(" ");for(let o=3;o<s.length;o++){const a=s[o],f=n.matchPrefix(r,"a=rtpmap:"+a+" ")[0];if(f){const c=n.parseRtpMap(f),p=n.matchPrefix(r,"a=fmtp:"+a+" ");switch(c.parameters=p.length?n.parseFmtp(p[0]):{},c.rtcpFeedback=n.matchPrefix(r,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),e.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(c.name.toUpperCase());break}}}return n.matchPrefix(r,"a=extmap:").forEach(o=>{e.headerExtensions.push(n.parseExtmap(o))}),e},n.writeRtpDescription=function(r,e){let i="";i+="m="+r+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,e.codecs.forEach(o=>{i+=n.writeRtpMap(o),i+=n.writeFmtp(o),i+=n.writeRtcpFb(o)});let s=0;return e.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),e.headerExtensions&&e.headerExtensions.forEach(o=>{i+=n.writeExtmap(o)}),i},n.parseRtpEncodingParameters=function(r){const e=[],i=n.parseRtpParameters(r),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=n.matchPrefix(r,"a=ssrc:").map(d=>n.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),f=a.length>0&&a[0].ssrc;let c;const p=n.matchPrefix(r,"a=ssrc-group:FID").map(d=>d.substr(17).split(" ").map(l=>parseInt(l,10)));p.length>0&&p[0].length>1&&p[0][0]===f&&(c=p[0][1]),i.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let m={ssrc:f,codecPayloadType:parseInt(d.parameters.apt,10)};f&&c&&(m.rtx={ssrc:c}),e.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:f,mechanism:o?"red+ulpfec":"red"},e.push(m))}}),e.length===0&&f&&e.push({ssrc:f});let u=n.matchPrefix(r,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substr(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8:u=void 0,e.forEach(d=>{d.maxBitrate=u})),e},n.parseRtcpParameters=function(r){const e={},i=n.matchPrefix(r,"a=ssrc:").map(a=>n.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(e.cname=i.value,e.ssrc=i.ssrc);const s=n.matchPrefix(r,"a=rtcp-rsize");e.reducedSize=s.length>0,e.compound=s.length===0;const o=n.matchPrefix(r,"a=rtcp-mux");return e.mux=o.length>0,e},n.writeRtcpParameters=function(r){let e="";return r.reducedSize&&(e+=`a=rtcp-rsize\r
`),r.mux&&(e+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(e+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),e},n.parseMsid=function(r){let e;const i=n.matchPrefix(r,"a=msid:");if(i.length===1)return e=i[0].substr(7).split(" "),{stream:e[0],track:e[1]};const s=n.matchPrefix(r,"a=ssrc:").map(o=>n.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return e=s[0].value.split(" "),{stream:e[0],track:e[1]}},n.parseSctpDescription=function(r){const e=n.parseMLine(r),i=n.matchPrefix(r,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substr(19),10)),isNaN(s)&&(s=65536);const o=n.matchPrefix(r,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:e.fmt,maxMessageSize:s};const a=n.matchPrefix(r,"a=sctpmap:");if(a.length>0){const f=a[0].substr(10).split(" ");return{port:parseInt(f[0],10),protocol:f[1],maxMessageSize:s}}},n.writeSctpDescription=function(r,e){let i=[];return r.protocol!=="DTLS/SCTP"?i=["m="+r.kind+" 9 "+r.protocol+" "+e.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+e.port+`\r
`]:i=["m="+r.kind+" 9 "+r.protocol+" "+e.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+e.port+" "+e.protocol+` 65535\r
`],e.maxMessageSize!==void 0&&i.push("a=max-message-size:"+e.maxMessageSize+`\r
`),i.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(r,e,i){let s;const o=e!==void 0?e:2;return r?s=r:s=n.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(r,e){const i=n.splitLines(r);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substr(2)}return e?n.getDirection(e):"sendrecv"},n.getKind=function(r){return n.splitLines(r)[0].split(" ")[0].substr(2)},n.isRejected=function(r){return r.split(" ",2)[1]==="0"},n.parseMLine=function(r){const i=n.splitLines(r)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},n.parseOLine=function(r){const i=n.matchPrefix(r,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},n.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const e=n.splitLines(r);for(let i=0;i<e.length;i++)if(e[i].length<2||e[i].charAt(1)!=="=")return!1;return!0},t.exports=n})(D);const C=D.exports,Te=he({__proto__:null,default:C},[D.exports]);function S(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const n=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new n(e),s=C.parseCandidate(e.candidate),o=Object.assign(i,s);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new n(e)},t.RTCIceCandidate.prototype=n.prototype,g(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}function v(t,n){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(a){if(!a||!a.sdp)return!1;const f=C.splitSections(a.sdp);return f.shift(),f.some(c=>{const p=C.parseMLine(c);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},e=function(a){const f=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;const c=parseInt(f[1],10);return c!==c?-1:c},i=function(a){let f=65536;return n.browser==="firefox"&&(n.version<57?a===-1?f=16384:f=2147483637:n.version<60?f=n.version===57?65535:65536:f=2147483637),f},s=function(a,f){let c=65536;n.browser==="firefox"&&n.version===57&&(c=65535);const p=C.matchPrefix(a.sdp,"a=max-message-size:");return p.length>0?c=parseInt(p[0].substr(19),10):n.browser==="firefox"&&f!==-1&&(c=2147483637),c},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const f=e(arguments[0]),c=i(f),p=s(arguments[0],f);let u;c===0&&p===0?u=Number.POSITIVE_INFINITY:c===0||p===0?u=Math.max(c,p):u=Math.min(c,p);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return u}}),this._sctp=d}return o.apply(this,arguments)}}function T(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function n(e,i){const s=e.send;e.send=function(){const a=arguments[0],f=a.length||a.size||a.byteLength;if(e.readyState==="open"&&i.sctp&&f>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(e,arguments)}}const r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=r.apply(this,arguments);return n(i,this),i},g(t,"datachannel",e=>(n(e.channel,e.target),e))}function E(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const e=n[r];n[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}function x(t,n){if(!t.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return r.apply(this,arguments)}}function R(t,n){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function P(t,n){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>r.apply(this,[o]))})}const Re=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:S,shimMaxMessageSize:v,shimSendThrowTypeError:T,shimConnectionState:E,removeExtmapAllowMixed:x,shimAddIceCandidateNullOrEmpty:R,shimParameterlessSetLocalDescription:P},Symbol.toStringTag,{value:"Module"}));function Pe({window:t}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=z,e=ye(t),i={browserDetails:e,commonShim:Re,extractVersion:y,disableLog:ge,disableWarnings:Ce,sdp:Te};switch(e.browser){case"chrome":if(!j||!b||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(e.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=j,R(t,e),P(t),J(t,e),V(t),b(t,e),K(t),X(t,e),$(t),B(t),H(t),Y(t,e),S(t),E(t),v(t,e),T(t),x(t,e);break;case"firefox":if(!A||!k||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=A,R(t,e),P(t),Q(t,e),k(t,e),Z(t),ee(t),W(t),w(t),te(t),re(t),ne(t),ie(t),se(t),S(t),E(t),v(t,e),T(t);break;case"safari":if(!F||!n.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=F,R(t,e),P(t),ue(t),me(t),ce(t),oe(t),ae(t),de(t),pe(t),le(t),S(t),v(t,e),T(t),x(t,e);break;default:r("Unsupported browser!");break}return i}const _e=Pe({window:typeof window>"u"?void 0:window});export{_e as default};
